JSON.stringify=JSON.stringify||function(t){var o=typeof t;if("object"!=o||null===t)return"string"==o&&(t='"'+t+'"'),String(t);var e,i,n=[],a=t&&t.constructor==Array;for(e in t)i=t[e],o=typeof i,"string"==o?i='"'+i+'"':"object"==o&&null!==i&&(i=JSON.stringify(i)),n.push((a?"":'"'+e+'":')+String(i));return(a?"[":"{")+String(n)+(a?"]":"}")},jQuery(document).ready(function(t){"use strict";var o,e,i={settings:{ID:t("#anva_builder_id").val(),button:t("#anva-builder-button"),checked:t(".anva-builder-enable"),fields:t(".anva-input-builder"),itemUl:t("#builder-sortable-items"),itemLi:t("#builder-sortable-items li"),element:t(".builder-elements li .element-shortcode"),root:t("html, body"),editorHeight:200},init:function(){e=this.settings,i.enable(),i.sortItems(),i.addItem(),i.editItem(),i.moveItem(),i.removeItem(),i.removeAllItems(),i.itemData(),i.publish(),i.tabs(),i.tooltip(),i.importExport(),i.extras()},enable:function(){e.checked.length>0&&(i.checked(e.checked),e.checked.live("change",function(){i.checked(t(this))})),e.button.on("click",function(t){t.preventDefault(),e.checked.trigger("click")})},checked:function(o){var i=e.button.data("enable"),n=e.button.data("disable");o.is(":checked")?(e.button.text(n),e.fields.slideDown(),t("#"+e.ID).addClass("anva-builder-active"),t("#postdivrich").fadeOut("fast",function(){t(this).css("paddingTop","120px")}),e.root.animate({scrollTop:t("#titlediv").offset().top-32},400)):o.is(":checked")||(e.button.text(i),e.fields.slideUp(),t("#"+e.ID).removeClass("anva-builder-active"),t("#postdivrich").fadeIn("fast",function(){t(this).css("paddingTop","0px")}),e.root.animate({scrollTop:t("#postdivrich").offset().top-32},400))},dragItems:function(){e.element.draggable({connectToSortable:"#builder-sortable-items",revert:"invalid",zIndex:199,helper:function(o){var e=i.buildItem();return t(e.html).addClass("block").css("minWidth","300px")},start:function(t,o){},stop:function(t,o){}})},sortItems:function(){e.itemUl.sortable({handle:".thumbnail",placeholder:"ui-state-highlight",revert:20,cursor:"move",helper:"clone",sort:function(t,o){o.item.removeClass("animated")},receive:function(t,o){},update:function(t,o){}}),e.itemUl.find(".thumbnail").disableSelection()},buildItem:function(){var o=t.now(),e=t("#anva_shortcode").val(),i=t("#anva_shortcode_title").val(),n=t("#anva_shortcode_image").val();if(""!=e){var a={};a.id=o,a.shortcode=e;var c,l=JSON.stringify(a),s=anvaJs.ajaxurl+"?action=anva_builder_get_fields&&shortcode="+e+"&rel="+o;return c='<li id="'+o+'" class="item item-'+o+" "+e+' ui-state-default animated bounceIn">',c+='<div class="actions">',c+='<a href="#" class="button-move-up"></a>',c+='<a href="#" class="button-move-down"></a>',c+='<a href="'+s+'" class="button-edit" data-id="'+o+'"></a>',c+='<a href="#" class="button-remove"></a>',c+="</div>",c+='<div class="thumbnail">',c+='<img src="'+n+'" alt="'+i+'" />',c+="</div>",c+='<div class="title">',c+='<span class="shortcode-type">'+i+"</span>",c+='<span class="shortcode-title"></span>',c+="</div>",c+='<span class="spinner spinner-'+o+'"></span>',c+='<div class="clear"></div>',c+="</li>",{id:o,shortcode:e,title:i,image:n,ajax:s,html:c,data:a,json:l}}return!1},addItem:function(){t("#add-builder-item").on("click",function(o){if(o.preventDefault(),t(this).attr("disabled"))return!1;if(""==t("#anva_shortcode").val())return alert(anvaJs.builder_empty),!1;var n=i.buildItem();return n?(t(this).attr("disabled","disabled"),e.itemUl.append(n.html),e.itemUl.removeClass("empty"),t("#"+n.id).data("anva_builder_settings",n.json),"divider"!=n.shortcode&&(t("#"+n.id).find(".button-edit").trigger("click"),e.root.animate({scrollTop:t("#"+n.id).offset().top-32},1e3)),"divider"==n.shortcode&&t(this).removeAttr("disabled"),e.element.removeClass("selected"),t("#anva_shortcode").val(""),t("#anva_shortcode_title").val(""),void t("#anva_shortcode_image").val("")):!1})},editItem:function(){t(document).on("click","#builder-sortable-items .actions a.button-edit",function(o){o.preventDefault();var i=t(this).parent(".actions").parent("li"),n=i.attr("id"),a=t("#item-inner-"+n);if(0==a.length){t("#anva_current_item").val(t(this).attr("data-id"));var c=t(this).attr("href");i.find("span.spinner").css("visibility","visible");var l=t.ajax({type:"GET",cache:!1,url:c,data:"",success:function(o){i.append('<div id="item-inner-'+n+'" class="item-inner item-inner-'+n+'" style="display:none;">'+o+"</div>"),t("#"+n).addClass("has-inline-content")}});t.when(l).then(function(){if(t("#item-inner-"+n).slideToggle(),i.find("span.spinner").css("visibility","hidden"),t("#add-builder-item").removeAttr("disabled"),t(".colorpicker").wpColorPicker(),t(".anva-wp-editor").length>0){var o={mceInit:{height:e.editorHeight}};t(".anva-wp-editor").wp_editor(o)}t(".rangeslider").on("mousemove",function(){var o=t(this);o.next("output").text(o.val())}).trigger("mousemove"),e.root.animate({scrollTop:t("#"+n).offset().top-32},1e3)})}else t("#item-inner-"+n).slideToggle()})},moveItem:function(){e.itemLi.find("a.button-move-down").on("click",function(o){o.preventDefault();var e=t(this).parent(".actions").parent("li").attr("id"),i=t("#"+e).next().attr("id");t("#"+i).insertBefore("#"+e)}),e.itemLi.find("a.button-move-up").on("click",function(o){o.preventDefault();var e=t(this).parent(".actions").parent("li").attr("id"),i=t("#"+e).prev().attr("id");t("#"+i).insertAfter("#"+e)})},removeItem:function(){t(document).on("click","#builder-sortable-items a.button-remove",function(o){o.preventDefault();var e=t(this).parent(".actions").parent("li");confirm(anvaJs.builder_remove)&&(e.fadeOut(),setTimeout(function(){e.remove(),0==t("#builder-sortable-items li").length&&t("#builder-sortable-items").addClass("empty")},500))})},removeAllItems:function(){t(document).on("click","#remove-all-items",function(o){return o.preventDefault(),0==t("#builder-sortable-items li").length?(alert(anvaJs.builder_remove_empty),!1):void(confirm(anvaJs.builder_remove_all)&&(t("#builder-sortable-items li").remove(),setTimeout(function(){0==t("#builder-sortable-items li").length&&t("#builder-sortable-items").addClass("empty")},500)))})},itemData:function(){e.element.on("click",function(o){o.preventDefault(),e.element.removeClass("selected"),t(this).addClass("selected");var i=t(this).data("element"),n=t(this).data("title"),a=t(this).find("img").attr("src");t("#anva_shortcode").val(i),t("#anva_shortcode_title").val(n),t("#anva_shortcode_image").val(a)})},publish:function(){t("#publish").on("click",function(){t("#builder-sortable-items li").length>0&&(t("#builder-sortable-items li").each(function(){t(this).append('<textarea style="display:none" name="'+e.ID+"["+t(this).attr("id")+'][data]">'+t(this).data("anva_builder_settings")+"</textarea>")}),t("#anva_shortcode_order").val(e.itemUl.sortable("toArray"))),t("#anva-import").val(""),t("#anva-export").val("")})},tabs:function(){t("#elements-wrapper").tabs({hide:{effect:"fade",duration:100},show:{effect:"fade",duration:100}})},tooltip:function(){t(".tooltip").tooltipster({animation:"grow",delay:200,maxWidth:200,theme:"tooltipster-light",touchDevices:!0,trigger:"hover"}),t(".anva-tooltip-info").tooltipster({animation:"fade",delay:200,maxWidth:400,theme:"tooltipster-white",touchDevices:!0,trigger:"hover",position:"bottom-right",content:t(".anva-tooltip-info-html").html(),contentAsHTML:!0})},importExport:function(){t(".anva-backup-container > a").on("click",function(o){o.preventDefault(),t(".anva-backup-container").toggleClass("active")}),t(document).on("click",".button-export",function(o){t("#builder-sortable-items li").each(function(){t(this).hasClass("item-unsaved")&&(alert(anvaJs.builder_unsave),o.preventDefault())}),t("#anva-export").val(1)}),t(document).on("click",".button-import",function(o){""==t("#anva-import-file").val()&&(alert(anvaJs.builder_import),o.preventDefault()),t(".wrap > form").attr("enctype","multipart/form-data"),t("#anva-import").val(1)})},extras:function(){t("#"+e.ID).addClass("anva-builder"),t(document).on("click","#builder-sortable-items li",function(){t("#anva_current_item").val(t(this).attr("id"))}),t(document).on("click",".anva-remove-image",function(o){o.preventDefault(),t(this).parent(".screenshot").prev().trigger("click")}),t(document).on("click",".anva-upload-button",function(e){e.preventDefault();var i=t(this).data("id"),n=t("#"+i+"_button"),a=t("#"+i+"_image"),c=n.data("remove"),l=n.data("upload");if(c==n.text())t("#"+i).val(""),a.slideUp("fast"),n.text(l),n.removeClass("remove-image"),setTimeout(function(){a.find("img").remove(),a.find("a").remove()},500);else if(l==n.text()){if(o)return void o.open();o=wp.media({title:anvaJs.builder_upload,button:{text:anvaJs.builder_select_image,close:!1},multiple:!1}),o.on("select",function(){var e=o.state().get("selection").first().toJSON();t("#"+i).val(e.url),a.append('<img src="'+e.url+'" /><a href="#" class="anva-remove-image">X</a>').slideDown("fast"),n.text(c),n.addClass("remove-image"),o.close()}),o.open()}})}};i.init()});
