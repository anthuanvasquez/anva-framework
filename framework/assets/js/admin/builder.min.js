JSON.stringify=JSON.stringify||function(t){var e=typeof t;if("object"!=e||null===t)return"string"==e&&(t='"'+t+'"'),String(t);var i,a,n=[],o=t&&t.constructor==Array;for(i in t)a=t[i],e=typeof a,"string"==e?a='"'+a+'"':"object"==e&&null!==a&&(a=JSON.stringify(a)),n.push((o?"":'"'+i+'":')+String(a));return(o?"[":"{")+String(n)+(o?"]":"}")},jQuery(document).ready(function(t){"use strict";var e,i,a={settings:{ID:t("#anva_builder_id").val(),button:t("#anva-builder-button"),checked:t(".anva-builder-enable"),fields:t(".anva-input-builder"),itemUl:t("#builder-sortable-items"),itemLi:t("#builder-sortable-items li"),element:t(".builder-elements li .element-shortcode"),root:t("html, body"),editorHeight:200},init:function(){i=this.settings,a.enable(),a.sortItems(),a.addItem(),a.editItem(),a.moveItem(),a.removeItem(),a.removeAllItems(),a.itemData(),a.publish(),a.tabs(),a.tooltip(),a.importExport(),a.extras()},enable:function(){i.checked.length>0&&(a.checked(i.checked),i.checked.live("change",function(){a.checked(t(this))})),i.button.on("click",function(t){t.preventDefault(),i.checked.trigger("click")})},checked:function(e){var a=i.button.data("enable"),n=i.button.data("disable");e.is(":checked")?(i.button.text(n),i.fields.slideDown(),t("#"+i.ID).addClass("anva-builder-active"),t("#minor-publishing-actions").hide(),t("#postdivrich").fadeOut("fast",function(){t(this).css("paddingTop","120px")}),t("#"+i.ID).hasClass("anva-builder-active")&&(console.log(t("#"+i.ID)),t("#publish").val(anvaJs.builder_publish_items)),i.root.animate({scrollTop:t("#titlediv").offset().top-32},400)):e.is(":checked")||(i.button.text(a),i.fields.slideUp(),t("#"+i.ID).removeClass("anva-builder-active"),t("#minor-publishing-actions").show(),t("#postdivrich").fadeIn("fast",function(){t(this).css("paddingTop","0px")}),t("#"+i.ID).hasClass("anva-builder-active")||t("#publish").val(anvaJs.builder_publish_update),i.root.animate({scrollTop:t("#postdivrich").offset().top-32},400))},dragItems:function(){i.element.draggable({connectToSortable:"#builder-sortable-items",revert:"invalid",zIndex:199,helper:function(e){var i=a.buildItem();return t(i.html).addClass("block").css("minWidth","300px")},start:function(t,e){},stop:function(t,e){}})},sortItems:function(){i.itemUl.sortable({handle:".thumbnail",placeholder:"ui-state-highlight",revert:20,cursor:"move",helper:"clone",sort:function(t,e){e.item.removeClass("animated")},receive:function(t,e){},update:function(t,e){}}),i.itemUl.find(".thumbnail").disableSelection()},buildItem:function(){var e=t.now(),i=t("#anva_shortcode").val(),a=t("#anva_shortcode_title").val(),n=t("#anva_shortcode_image").val();if(""!=i){var o={};o.id=e,o.shortcode=i;var r,l=JSON.stringify(o),s=anvaJs.ajaxurl+"?action=anva_builder_get_fields&&shortcode="+i+"&rel="+e;return r='<li id="'+e+'" class="item item-'+e+" "+i+' ui-state-default animated bounceIn">',r+='<div class="actions">',r+='<a href="#" class="button-move-up"></a>',r+='<a href="#" class="button-move-down"></a>',r+='<a href="'+s+'" class="button-edit" data-id="'+e+'"></a>',r+='<a href="#" class="button-remove"></a>',r+="</div>",r+='<div class="thumbnail">',r+='<img src="'+n+'" alt="'+a+'" />',r+="</div>",r+='<div class="title">',r+='<span class="shortcode-type">'+a+"</span>",r+='<span class="shortcode-title"></span>',r+="</div>",r+='<span class="spinner spinner-'+e+'"></span>',r+='<div class="clear"></div>',r+="</li>",{id:e,shortcode:i,title:a,image:n,ajax:s,html:r,data:o,json:l}}return!1},addItem:function(){t("#add-builder-item").on("click",function(e){if(e.preventDefault(),t(this).attr("disabled"))return!1;if(""==t("#anva_shortcode").val())return alert(anvaJs.builder_empty),!1;var n=a.buildItem();return n?(t(this).attr("disabled","disabled"),i.itemUl.append(n.html),i.itemUl.removeClass("empty"),t("#"+n.id).data("anva_builder_settings",n.json),"divider"!=n.shortcode&&(t("#"+n.id).find(".button-edit").trigger("click"),i.root.animate({scrollTop:t("#"+n.id).offset().top-32},1e3)),"divider"==n.shortcode&&t(this).removeAttr("disabled"),i.element.removeClass("selected"),t("#anva_shortcode").val(""),t("#anva_shortcode_title").val(""),void t("#anva_shortcode_image").val("")):!1})},editItem:function(){t(document).on("click","#builder-sortable-items .actions a.button-edit",function(e){e.preventDefault();var a=t(this).parent(".actions").parent("li"),n=a.attr("id"),o=t("#item-inner-"+n);if(0==o.length){t("#anva_current_item").val(t(this).attr("data-id"));var r=t(this).attr("href");a.find("span.spinner").css("visibility","visible");var l=t.ajax({type:"GET",cache:!1,url:r,data:"",success:function(e){a.append('<div id="item-inner-'+n+'" class="item-inner item-inner-'+n+'" style="display:none;">'+e+"</div>"),t("#"+n).addClass("has-inline-content")}});t.when(l).then(function(){if(t("#item-inner-"+n).slideToggle(),a.find("span.spinner").css("visibility","hidden"),t("#add-builder-item").removeAttr("disabled"),t(".colorpicker").wpColorPicker(),t(".anva-wp-editor").length>0){var e={mceInit:{height:i.editorHeight}};t(".anva-wp-editor").wp_editor(e)}t(".rangeslider").on("mousemove",function(){var e=t(this);e.next("output").text(e.val())}).trigger("mousemove"),i.root.animate({scrollTop:t("#"+n).offset().top-32},1e3)})}else t("#item-inner-"+n).slideToggle()})},moveItem:function(){i.itemLi.find("a.button-move-down").on("click",function(e){e.preventDefault();var i=t(this).parent(".actions").parent("li").attr("id"),a=t("#"+i).next().attr("id");t("#"+a).insertBefore("#"+i)}),i.itemLi.find("a.button-move-up").on("click",function(e){e.preventDefault();var i=t(this).parent(".actions").parent("li").attr("id"),a=t("#"+i).prev().attr("id");t("#"+a).insertAfter("#"+i)})},removeItem:function(){t(document).on("click","#builder-sortable-items a.button-remove",function(e){e.preventDefault();var i=t(this).parent(".actions").parent("li");confirm(anvaJs.builder_remove)&&(i.fadeOut(),setTimeout(function(){i.remove(),0==t("#builder-sortable-items li").length&&t("#builder-sortable-items").addClass("empty")},500))})},removeAllItems:function(){t(document).on("click","#remove-all-items",function(e){return e.preventDefault(),0==t("#builder-sortable-items li").length?(alert(anvaJs.builder_remove_empty),!1):void(confirm(anvaJs.builder_remove_all)&&(t("#builder-sortable-items li").remove(),setTimeout(function(){0==t("#builder-sortable-items li").length&&t("#builder-sortable-items").addClass("empty")},500)))})},itemData:function(){i.element.on("click",function(e){e.preventDefault(),i.element.removeClass("selected"),t(this).addClass("selected");var a=t(this).data("element"),n=t(this).data("title"),o=t(this).find("img").attr("src");t("#anva_shortcode").val(a),t("#anva_shortcode_title").val(n),t("#anva_shortcode_image").val(o)})},publish:function(){t("#publish").on("click",function(){t("#builder-sortable-items li").length>0&&(t("#builder-sortable-items li").each(function(){t(this).append('<textarea style="display:none" name="'+i.ID+"["+t(this).attr("id")+'][data]">'+t(this).data("anva_builder_settings")+"</textarea>")}),t("#anva_shortcode_order").val(i.itemUl.sortable("toArray"))),t("#anva-import").val(""),t("#anva-export").val("")})},tabs:function(){t("#elements-wrapper").tabs({hide:{effect:"fade",duration:100},show:{effect:"fade",duration:100}})},tooltip:function(){t(".tooltip").tooltipster({animation:"grow",delay:200,maxWidth:200,theme:"tooltipster-light",touchDevices:!0,trigger:"hover"}),t(".anva-tooltip-info").tooltipster({animation:"fade",delay:200,maxWidth:400,theme:"tooltipster-white",touchDevices:!0,trigger:"hover",position:"bottom-right",content:t(".anva-tooltip-info-html").html(),contentAsHTML:!0})},importExport:function(){t(".anva-backup-container > a").on("click",function(e){e.preventDefault(),t(".anva-backup-container").toggleClass("active")}),t(document).on("click",".button-export",function(e){t("#builder-sortable-items li").each(function(){t(this).hasClass("item-unsaved")&&(alert(anvaJs.builder_unsave),e.preventDefault())}),t("#anva-export").val(1)}),t(document).on("click",".button-import",function(e){""==t("#anva-import-file").val()&&(alert(anvaJs.builder_import),e.preventDefault()),t(".wrap > form").attr("enctype","multipart/form-data"),t("#anva-import").val(1)})},extras:function(){t("#"+i.ID).addClass("anva-builder"),t(document).on("click","#builder-sortable-items li",function(){t("#anva_current_item").val(t(this).attr("id"))}),t(document).on("click",".anva-remove-image",function(e){e.preventDefault(),t(this).parent(".screenshot").prev().trigger("click")}),t(document).on("click",".anva-upload-button",function(i){i.preventDefault();var a=t(this).data("id"),n=t("#"+a+"_button"),o=t("#"+a+"_image"),r=n.data("remove"),l=n.data("upload");if(r==n.text())t("#"+a).val(""),o.slideUp("fast"),n.text(l),n.removeClass("remove-image"),setTimeout(function(){o.find("img").remove(),o.find("a").remove()},500);else if(l==n.text()){if(e)return void e.open();e=wp.media({title:anvaJs.builder_upload,button:{text:anvaJs.builder_select_image,close:!1},multiple:!1}),e.on("select",function(){var i=e.state().get("selection").first().toJSON();t("#"+a).val(i.url),o.append('<img src="'+i.url+'" /><a href="#" class="anva-remove-image">X</a>').slideDown("fast"),n.text(r),n.addClass("remove-image"),e.close()}),e.open()}})}};a.init()});
